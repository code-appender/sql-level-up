# 1장. DBMS 아키텍처

## DBMS 아키텍처 개요

사용자 혹은 애플리케이션(SQL 구문) -> DBMS(쿼리 평가 엔진, 접근 메서드, 여러 매니저) -> DB(내부 데이터 접근 및 처리)

DBMS를 통한 다양한 처리 과정에 대해 알 필요가 있다.

1. 쿼리 평가 엔진
-> SQL 구문 분석 및 실행 계획 작성 (DBMS의 핵심이자 성능에 밀접한 관련이 있는 모듈)
2. 버퍼 매니저
3. 디스크 용량 매니저
4. 트랜잭션 매니저와 락 매니저
5. 리커버리 매니저

하나의 구문을 처리하는 관점에서의 성능 향상은 쿼리 평가 엔진을 어떻게 사용하나에 있다!

## DBMS와 버퍼

기억장치에는 기억비용과 접근속도가 서로 반비례함. ex) 접근 속도가 빠르다? -> 기억비용이 비싸다.
그럼 데이터를 빠르게 읽고 쓰고 싶으니까 메모리만을 고집하고 사용한다? RAM 용량을 무자비하게 늘릴수가 있다면 가능할지도 모르나 할 수가 없다.
그렇다고 다량의 데이터를 영속적으로 저장하기 위해 디스크만을 고집한다면 해당 데이터에 접근하는 속도가 느려 답답해 죽어버릴지도 모른다.

이 부분을 어떻게 처리해야 할까? 에 대한 문제가 첫 번째 트레이드오프

### DBMS에서 사용하는 기억장치
HDD
- 데이터를 저장하는 매체 (대부분 HDD 사용)
- 2차 기억장치이며 좋지도 않고 나쁘지도 않은 매체 (범용성을 위해 사용)

메모리
- 기억 비용 매우 비쌈
- 그럼에도 사용하는 이유 : 버퍼를 활용한 속도 향상 -> 접근성 높은 데이터를 넣어놓는다면 빠른 속도로 READ 가능!

### 버퍼의 종류
데이터 캐시 (SELECT)
- 읽기만 할 때 유용하다. 버퍼에 데이터가 있다면 매우 빠르지만 없다면 디스크를 거쳐야하므로 느리다.

로그 버퍼 (INSERT, UPDATE, DELETE 등)
- 보통 갱신 처리를 위해 사용하는 버퍼. 비동기적 처리를 위해 로그 버퍼에 갱신 정보를 올려놓은 후 이를 커밋함과 동시에 변경

#### 트레이드오프
메모리 특성
- 로그 버퍼에 올라온 데이터가 있을때 서버 장애가 발생한다면? -> 매우 큰 혼란 야기함
- 이를 방지하고자 커밋 시점에 로그파일에 해당 데이터 갱신 정보를 씀으로써 정합성을 유지
- 하지만 커밋 진행 시 반드시 동기 처리 해야함

동기 처리 (데이터 정합성 O, 성능 X) <-> 비동기 처리 (데이터 정합성 X, 성능 O)

시스템 특성
- 진행하는 서비스의 목적에 따라 달리 결정
- 만약 검색이 메인이라면 데이터 캐시의 용량 상승, 갱신이 메인이라면 로그 버퍼의 용량 상승

### 워킹 메모리
메모리 영역 중 정렬 혹은 해시 관련 처리에 사용되는 영역.
- 정렬 : ORDER BY, 집합 연산, 윈도우 함수 등
- 해시 : 테이블 결합, 해시 결합

만약 워킹 메모리 용량 부족하다면? -> 디스크 사용 -> 접근 속도 느려짐

## DBMS와 실행 계획

### 데이터 접근 방법
파서 -> 옵티마이저 -> 카탈로그 매니저 -> 플랜 평가

1. 파서
- 구문 분석 및 검사 (컴파일 시점의 예외 발생과 비슷한 역할)
2. 옵티마이저
- 최적화된 실행 계획 작성
3. 카탈로그 매니저
- 실행 계획을 세우기 위해 통계 정보 제공하는 모듈 (실행 계획에 있어 통계 정보가 매우 중요)
4. 플랜 평가
- 최적의 실행 결과 선택

옵티마이저가 만능은 아니다 -> 통계 정보가 부정확하다면 옵티마이저가 실패함. -> 통계 정보 갱신하는 시점 검토

### 실행 계획
SQL 구문의 복잡성 혹은 데이터양이 많은 테이블에 접근하게 되면 반응 지연이 일어날 수도 있다.
이를 확인하기 위해서 제일 먼저 실행 계획을 확인해봐야 한다.

#### 기본적인 실행 계획 종류
1. 테이블 풀 스캔의 실행 계획
2. 인덱스 스캔의 실행 계획
- 모집합 레코드 수에서 선택되는 레코드 수가 적다? 풀스캔보다 빠르다.
3. 간단한 테이블 결합의 실행 계획
- 결합 시 알고리즘은 3가지를 사용함
- Nested Loops(이중 결합), Sort Merge, Hash

### 실행 계획의 중요성
옵티마이저는 우수하지만 완벽한 것은 아니다.
여러 문제가 있겠지만 여러 조건을 맞췄는데도 최적의 실행 계획을 선택하지 못한다면 최후의 수단으로 수동으로 변경해주어야한다.