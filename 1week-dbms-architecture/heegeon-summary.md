# 1장 DBMS 아키텍처

---

## 1.1 DBMS 아키텍쳐 개요

> DBMS는 데이터를 저장하고 관리하는 기능을 수행하는 소프트웨어이다.
> 
> DBMS는 데이터베이스를 관리하는 데 필요한 여러 기능을 제공하는데, 이러한 기능을 모듈화하여 계층적으로 구성한 것을 DBMS 아키텍처라고 한다.

### 1.1.1 쿼리 평가 엔진
- 사용자로부터 입력받은 SQL 구문을 분석하고 어떤 순서로 기억장치의 데이터에 접근할지 결정한다.
- 계획을 세우고 실행하는 DBMS의 핵심 기능을 담당하는 모듈이다.

### 1.1.2 버퍼 매니저
- DBMS는 버퍼라는 특별한 용도로 사용하는 메모리 영역을 하나 가지고 있는데 이 메모리를 관리하는 것이 바로 버퍼 매니저이다.

### 1.1.3 디스크 용량 매니저
- 데이터 저장 공간을 관리하고 읽기 쓰기를 제어한다.

### 1.1.4 트랜잭션 매니저와 락 매니저
- 트랜잭션의 정합성을 유지하면서 실행시키고 필요한 경우 데이터에 락을 걸어 다른 사람의 요청을 대기시킨다.

### 1.1.5 리커버리 매니저
- DBMS 장애 상황에 대비하여 데이터를 정기적으로 백업하고 복구해주는 역할을 수행한다.

---

## 1.2 DBMS와 버퍼
> DBMS는 데이터 저장을 위해 여러 기억장치를 사용한다.

### 1.2.1 하드디스크(HDD)
- 하드디스크는 기억장치 계층에서 한 가운데에 있는 2차 기억장치다.

### 1.2.2 메모리
- 디스크에 비해 기억 비용이 굉장이 비싸서 하드웨어 1대에 탑재할 수 있는 양이 매우 적다.

### 1.2.3 버퍼(캐시)
- 버퍼는 메모리와 디스크 사이에서 데이터를 주고받는 역할을 한다.
- 디스크에 접근하는 시간은 메모리에 접근하는 시간에 비해 수십만 배 이상 느리기 때문에 버퍼를 사용하여 성능을 향상시킨다.
- 데이터 캐시
  - 디스크에 있는 데이터를 메모리에 미리 저장해두는 것을 말한다.
- 로그 버퍼
  - 트랜잭션의 연산 결과를 디스크에 기록하기 전에 메모리에 저장해두는 것을 말한다.

### 1.2.4 메모리 성질이 초래하는 트레이드오프
- 메모리에는 영속성이 없어서 전원이 꺼지면 데이터가 사라진다. -> 휘발성이다.
- 데이터 캐시라면 장애로 인해 데이터가 사라지더라도 복구할 수 있지만 로그 버퍼는 장애로 인해 데이터가 사라지면 복구할 수 없다.
- 이를 해결하기 위해 로그 버퍼에 기록한 연산 결과를 디스크에 정기적으로 기록하는 로그를 남기는 방법을 사용한다.
- 이 방법을 **Commit**이라고 한다.
- 커밋을 진행할 때는 반드시 디스크에 동기 접근이 발생하여 성능이 저하된다.

### 1.2.5 시스템 특성에 따른 트레이드오프
- 검색과 갱신 중 어느 것이 더 중요한지에 따른 트레이드오프가 발생한다.
- 일반적으로 로그 버퍼가 크다면 갱신 성능이 좋아지고, 데이터 캐시가 크다면 검색 성능이 좋아진다.

### 1.2.6 워킹 메모리
- DBMS에는 로그 버퍼와 데이터 캐시 이외에도 워킹 메모리라는 메모리 영역이 있다.
- SQL에서 정렬 또는 해시가 필요할 때 사용되고, 종료되면 해제되는 임시 영역이다.
- 워킹 메모리 영역이 너무 작으면 DBMS는 디스크를 사용하게 되고, 이는 성능 저하로 이어진다.
- "DBMS는 메모리가 부족하더라도 오류로 끝내지 않고 무언가를 계속 처리하려는 노력을 한다."

---


## 1.3 DBMS와 실행 계획
> 사용자가 데이터베이스에서 의식적으로 사용하는 것은 SQL레벨까지이다. 
> 
> 사용자는 데이터가 어떻게 저장되어 있는지, 어떤 순서로 데이터에 접근하는 것이 가장 빠른지 등을 알 필요가 없다.
> 
> RDB가 이렇게 권한 이양을 감행한데에는 비즈니스 전체의 생산성을 향상하기 위해서이다.

### 1.3.1 쿼리 평가 엔진의 처리 방식

#### 파서
- 사용자로부터 받은 SQL구문이 항상 올바르다는 보증이 없으므로 검사를 해준다.
- SQL구문을 정형적인 형식으로 변환해주기도 한다.

#### 옵티마이저
- DBMS의 두뇌이다.
- 선택 가능한 실행 계획을 작성하고, 비용을 연산하고, 가장 낮은 비용을 가진 실행 계획을 선택한다.

#### 카탈로그 매니저
- 카탈로그란 DBMS의 내부 정보를 모아놓은 테이블을 말하며 테이블 또는 인덱스의 통계 정보가 저장되어 있다.
- 옵티마이저는 카탈로그 매니저를 통해 통계 정보를 얻어온다.

#### 플랜 평가
- 옵티마이저가 작성한 실행 계획을 플랜 평가 모듈이 검토하여 최적의 실행 결과를 선택한다.

---

## 1.4 실행 계획이 SQL 구문의 성능을 결정

### 1.4.1 테이블 풀 스캔의 실행 계획
- 테이블 풀 스캔은 테이블의 모든 블록을 읽어서 원하는 데이터를 찾는 방법이다.

### 1.4.2 인덱스 스캔의 실행 계획
- 인덱스 스캔은 인덱스를 읽어서 원하는 데이터가 있는 블록을 찾아가는 방법이다.
- 조작 대싱아 되는 레코드 수가 1이 된다.

### 1.4.3 간단한 테이블 결합의 실행 계획
- 테이블 결합은 두 개 이상의 테이블에서 데이터를 읽어서 조합하는 방법이다.