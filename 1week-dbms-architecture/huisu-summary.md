# DBMS Architecture

## DBMS 아키텍처 개요

1. 쿼리 평가 엔진
    - 사용자로부터 입력받은 SQL 구문을 분석하고, 어떤 순서로 기억 장치에 접근할지 분석
    - 이때 결정되는 계획 → 실행 계획
    - 실행 계획에 기반을 둬서 데이터에 접근하는 방법 → 접근 메서드
2. 버퍼 매니저
    - 버퍼라는 특별한 용도로 사용하는 메모리 영역 확보
    - 버퍼 관리
3. 디스크 용량 매니저
    - 어디에 어떻게 데이터를 저장할지 관리
    - 데이터의 읽고 쓰기 제어
4. 트랜잭션 매니저와 락 매니저
    - 트랜잭션 정합성을 유지하면서 실행
    - 필요한 경우 데이터에 락을 걸어 다른 사람의 요청 대기
5. 리커버리 매니저
    - 데이터를 정기적으로 백업
    - 문제가 일어났을 때 복구

## DBMS와 버퍼

1. 기억 장치의 계층
    - 1차 기억 장치: 레지스터, 메모리
    - 2차 기억 장치: HDD, CD, DVD, 플래시 메모리
    - 3차 기억 장치: 테이프
    - 데이터를 저장하는 데 소요되는 기억 비용은 속도에 비례
2. DBMS와 기억 장치의 관계
    - HDD: DBMS가 데이터를 저장하는 매체는 현재 대부분 HDD
    - 메모리: 기억 비용이 비싸고 속도가 빠름
    - 자주 접근하는 데이터만 메모리에 올려 효율적으로 DBMS 관리 가능
    - 버퍼/캐시: 성능 향상을 목적으로 데이터를 저장하는 메모리
3. 메모리 위에 있는 두 개의 버퍼
    - 데이터 캐시
        - 디스크에 있는 데이터의 일부를 메모리에 유지하기 위해 사용
        - SELECT 구문
        - 디스크와 같은 저속 저장소에 접근하지 않고 처리 수행
    - 로그 버퍼
        - 갱신 처리와 관련
        - 곧바로 저장소에 있는 데이터를 변경하지 않고 로그 버퍼 위에 변경 정보를 보낸 후 디스크 변경 수행
        - SQL 구문 실행 시점과 저장소 갱신 시점에 차이가 있는 비동기 처리
        - 메모리에 갱신 정보를 받은 시점에서 사용자에게는 실행 완료를 통지한 뒤 내부적으로는 관련된 처리를 계속 수행
4. 메모리의 성질이 초래하는 트레이드오프
    - 휘발성: 메모리에는 데이터의 영속성 존재 X
    - 데이터 캐시: 메모리 위의 데이터가 사라져도 원본 데이터는 디스크에 존재
    - 로그 버퍼: 로그 버퍼 위 데이터가 디스크 위에 반영되기 전 장애가 발생하면 데이터 부정합 발생
        - DBMS가 갱신을 비동기로 하는 이상 언제든 발생
        - DBMS는 커밋 시점에 갱신 정보를 로그 파일에 써서 정합성을 유지하도록 함
        - 커밋 때는 동기 접근 발생
5. 시스템 특성에 따른 트레이드오프
    - 메모리는 한정된 자원
    - 검색 SQL이 주라면 데이터 캐시 많이 할당
    - 갱신 SQL이 주라면 로그 버퍼 많이 할당
6. 추가적인 메모리 영역 ‘워킹 메모리’
    - 정렬 또는 해시 관련 처리에 사용되는 작업용 영역
    - SQL이 종료되면 해지되지만 다루려는 데이터 양보다 작은 경우 DBMS 저장소 사용으로 넘어가게 됨
    - DBMS는 워킹 메모리가 부족할 때 사용하는 임시적인 영역 가짐
        - 저장소 위에 있어서 속도가 느림
        - 여러 개의 SQL을 동시에 실행하면 메모리가 넘쳐서 그런 경우 부하 검사를 실시해야 함

## DBMS와 실행 계획

1. 권항 이양의 죄악
    - 개발자가 데이터베이스에서 의식적으로 사용하는 것은 SQL 레벨이고 이후는 DBMS에게 위임
    - 비즈니스 생산성은 향상되지만 RDB에 대한 자세한 이해 결여
2. 데이터에 접근하는 방법은 어떻게 결정할까?
    - 파서: SQL 구문을 분석
    - 옵티마이저: 데이터 접근법인 실행 게획을 최적화
        - 인덱스 유무, 데이터 분산 또는 편향 정도, DBMS 내부 매개변수 등의 조건을 고려해서 선택 가능한 많은 실행 계획 작성
        - 이들의 비용 연산
        - 가장 낮은 비용을 가진 실행 계획 선택
    - 카탈로그 매니저: 옵티마이저에 중요한 정보를 제공하는 것
        - 테이블 또는 인덱스의 통계 정보가 저장됨
    - 플랜 평가: 옵티마이저가 SQL 구문에서 여러 개의 실행 계획을 세운 뒤 그것을 받아 최적화 실행결과를 선택하는 것
3. 옵티마이저와 통계 정보
    - 옵티마이저는 모든 상황에 대해 최적화하지 않음
    - 카탈로그 매니저가 관리하는 통계 정보에 대해 자료가 부족한 경우 실패
4. 최적의 실행 계획이 작성되게 하려면
    - 테이블의 데이터가 많이 바뀔 경우 카탈로그의 통계 정보도 갱신